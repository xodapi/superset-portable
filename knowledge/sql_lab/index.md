---
title: SQL Lab
status: public
created: 2026-01-28
tags: [sql, редактор, запросы]
---

# SQL Lab 💻

Мощный веб-редактор SQL для исследования данных.

---

## Интерфейс

```
┌─────────────────────────────────────────────────────┐
│ [База ▼] [Схема ▼]              [Запустить] [Save]  │
├───────────────────────────────┬─────────────────────┤
│                               │ Таблицы:            │
│  SELECT *                     │ ├─ users            │
│  FROM users                   │ ├─ orders           │
│  WHERE active = true          │ └─ products         │
│  LIMIT 100                    │                     │
│                               │                     │
├───────────────────────────────┴─────────────────────┤
│ Results (100 rows, 0.23s)                           │
│ ┌─────┬───────────┬────────────────┐                │
│ │ id  │ name      │ email          │                │
│ ├─────┼───────────┼────────────────┤                │
│ │ 1   │ Иванов    │ ivanov@...     │                │
│ └─────┴───────────┴────────────────┘                │
└─────────────────────────────────────────────────────┘
```

---

## Быстрый старт

### Открыть SQL Lab

**SQL Lab → SQL Editor** (или `Ctrl+E`)

### Написать запрос

```sql
SELECT *
FROM my_table
LIMIT 100
```

### Выполнить

- Кнопка **"Run"** ▶
- Или `Ctrl+Enter`

---

## Горячие клавиши

| Комбинация | Действие |
|------------|----------|
| `Ctrl + Enter` | Выполнить запрос |
| `Ctrl + Shift + Enter` | Выполнить выделенный фрагмент |
| `Ctrl + S` | Сохранить запрос |
| `Ctrl + Shift + F` | Форматировать SQL |
| `Ctrl + /` | Закомментировать строку |
| `Tab` | Автодополнение |
| `Ctrl + Space` | Вызвать автодополнение |

---

## Сохранение запросов

### Сохранить

1. Напишите запрос
2. **Save** или `Ctrl+S`
3. Введите название и описание

### Найти сохранённые

**SQL Lab → Saved Queries**

### Организация

Используйте понятные названия:
- ✅ `Продажи по регионам - Q1 2026`
- ❌ `query_1`

---

## Создание датасета

### Из результата запроса

1. Выполните запрос
2. **Save → Save Dataset**
3. Введите название
4. Датасет появится в списке

### Преимущества датасетов

- Можно строить диаграммы
- Кешируются результаты
- Удобнее для повторного использования

Подробнее: [[Виртуальные датасеты]]

---

## Вкладки запросов

### Несколько запросов

SQL Lab поддерживает вкладки:

```
┌─────────┬──────────┬──────────┬───┐
│ Query 1 │ Query 2  │ Query 3  │ + │
└─────────┴──────────┴──────────┴───┘
```

- **"+"** — новая вкладка
- **"×"** — закрыть вкладку

### Переименование

Дважды кликните на название вкладки.

---

## История запросов

### Просмотр истории

**SQL Lab → Query History**

### Фильтрация

- По статусу (success, failed, running)
- По базе данных
- По пользователю
- По дате

### Повторный запуск

1. Найдите запрос в истории
2. **⋮ → Run in SQL Editor**

---

## Результаты

### Просмотр

Результаты отображаются в таблице под редактором.

### Сортировка

Кликните на заголовок столбца.

### Экспорт

- **CSV** — для Excel
- **JSON** — для программ

### Копирование

`Ctrl+C` — копирует выделенные ячейки.

---

## Ограничения

| Параметр | Значение |
|----------|----------|
| **Row limit** | 50,000 (настраивается) |
| **Timeout** | 60 секунд (настраивается) |

### Изменение в конфиге

```python
# superset_config.py
ROW_LIMIT = 100000
SUPERSET_WEBSERVER_TIMEOUT = 120
```

---

## Полезные SQL-паттерны

### Агрегация

```sql
SELECT 
    region,
    COUNT(*) as orders_count,
    SUM(amount) as total_amount,
    AVG(amount) as avg_amount
FROM orders
GROUP BY region
ORDER BY total_amount DESC
```

### Оконные функции

```sql
SELECT 
    date,
    amount,
    SUM(amount) OVER (ORDER BY date) as running_total,
    amount - LAG(amount) OVER (ORDER BY date) as diff
FROM daily_sales
```

### CTE (Common Table Expressions)

```sql
WITH monthly_sales AS (
    SELECT 
        date_trunc('month', date) as month,
        SUM(amount) as revenue
    FROM sales
    GROUP BY 1
)
SELECT 
    month,
    revenue,
    revenue - LAG(revenue) OVER (ORDER BY month) as growth
FROM monthly_sales
```

---

## Jinja-шаблоны

SQL Lab поддерживает шаблоны Jinja2 для динамических запросов.

Подробнее: [[Jinja-шаблоны]]

### Примеры

```sql
-- Текущий пользователь
SELECT * FROM users WHERE owner = '{{ current_username() }}'

-- Временной диапазон от фильтра дашборда
SELECT * FROM sales 
WHERE date BETWEEN '{{ from_dttm }}' AND '{{ to_dttm }}'
```

---

## Async-запросы

### Для долгих запросов

1. Включите **"Run in async mode"**
2. Запрос выполнится в фоне
3. Результат появится в **Query History**

### Отмена

Во время выполнения — кнопка **"Stop"**.

---

## Советы

### ✅ Рекомендации

- Всегда используйте `LIMIT` для тестов
- Сохраняйте полезные запросы
- Используйте CTE для читаемости
- Создавайте датасеты из проверенных запросов

### ❌ Избегайте

- `SELECT *` на больших таблицах
- Запросов без `LIMIT`
- Хранения секретов в запросах

---

## См. также

- [[Jinja-шаблоны]] — динамические параметры
- [[Виртуальные датасеты]] — датасеты из запросов
- [[Подключение базы данных]] — настройка подключений
